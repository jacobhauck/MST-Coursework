\documentclass{homework}
\input{../../standardcmd.tex}
\input{../homework_shared.tex}

\usepackage{listings}
\usepackage{booktabs}

\newcommand{\hwnum}{9}
\renewcommand{\questiontype}{Problem}

\begin{document}
	\maketitle
	
	Consider the 1D heat equation
	\begin{equation*}
		u_t = \frac{1}{2}u_{xx} + f(x,t), \qquad 0 < x < 1, \;t > 0,
	\end{equation*}
	with source term
	\begin{equation*}
		f(x,t) = \left(\frac{\pi^2}{2}-1\right)\sin\left(\pi\left(x+\frac{1}{2}\right)\right)
	\end{equation*}
	and Dirichlet boundary conditions given by
	\begin{equation*}
		u(0,t) = e^{-t}, \qquad u(1,t) = -e^{-t}, \qquad t > 0
	\end{equation*}
	and initial condition
	\begin{equation*}
		u(x,0) = \sin\left(\pi\left(x+\frac{1}{2}\right)\right), \qquad 0\le x\le 1.
	\end{equation*}
	The exact solution is $u(x,t) = e^{-t}\sin\left(\pi\left(x+\frac{1}{2}\right)\right)$.
	
	\question
	
	\begin{alphaparts}
		\questionpart
		Discretizing this equation on the time interval $[0,1]$ using a central difference method in space and the forward Euler method in time with the space sample points $x_i = ih$ for $i =0,1,\dots, M$ and time sample points $t_n = nk$ for $n=0,1,\dots N$, where $h = \frac{1}{M}$, and $k = \frac{1}{N}$, we obtain
		\begin{align*}
			\frac{u^n_{i+1} - u^n_i}{k} &= \frac{1}{2}\cdot\frac{u^n_{i-1}-2u^n_i + u^n_{i+1}}{h^2} + f(x_i,t_n), \qquad i =1,2,\dots, M-1, \; n = 0,1,\dots, N-1,\\
			u^n_0 &= e^{-t_n}, \quad u^n_{M} = -e^{-t_n}, \qquad n = 0,1,\dots, N,\\
			u^0_i &= \sin\left(\pi\left(x+\frac{1}{2}\right)\right), \qquad i = 0,1,\dots, M.
		\end{align*}
		where $u^n_i \approx u(x_i, t_n)$. We can rewrite this system as
		\begin{equation*}
			U^{n+1} = U^n + k(AU^n + b^n),
		\end{equation*}
		where
		\begin{equation*}
			U^n = \left[\begin{matrix}u^n_1 \\ u^n_2 \\ \vdots \\ u^n_{M-1}\end{matrix}\right], \qquad A = \frac{1}{2h^2}\left[\begin{matrix}
				-2 & 1 \\
				1 & -2 & 1 \\ 
				& & \ddots \\
				& & 1 & -2 & 1 \\
				& & & 1 - 2
			\end{matrix}\right], \qquad
			b^n = \left[\begin{matrix}
				f(x_1,t_n) + \frac{e^{-t_n}}{2h^2} \\
				f(x_2,t_n) \\
				\vdots
				\\
				f(x_{M-2}, t_n) \\
				f(x_{M-1}, t_n) - \frac{e^{-t_n}}{2h^2}
			\end{matrix}\right].
		\end{equation*}
		This linear recurrence is implemented in \verb*|problem1.m| using a simple for loop.
		
		\questionpart The forward Euler method is unstable if $k > ch^2$ for some constant $c$. We determine this constant empirically to be roughly $1$ by using the bisection method in \verb*|stability_test.m|. By setting $h^2$ a little bit larger than $k$, we can still see the first-order convergence in $k$; see Table \ref{table:euler_time}.
		
		Observing second-order convergence in space is easier given the constraint $k < h^2$. We simply calculate the error for various values of $h$ with $k$ fixed and much smaller than the smallest value of $h^2$; see Table \ref{table:euler_space}. These tables are generated by running \verb*|problem1_calculations.m|.
		
		\begin{table}[h]
			\centering
			\begin{tabular}{@{}lllll@{}}
				\toprule
				$k$ & $L^\infty$ error & $L^\infty$ rate & $L^2$ error & $L^2$ rate \\
				\midrule
				1/1024&	2.508190e-04&	-	&1.824251e-04&	-\\
				1/4096&	6.352731e-05&	0.990599&	4.552322e-05&	1.001315\\
				1/16384&	1.587421e-05&	1.000346&	1.137542e-05&	1.000342\\
				1/65536	&3.968078e-06&	1.000086	&2.843515e-06&	1.000086\\
				1/262144&	9.920215e-07&	0.999998&	7.108574e-07&	1.000022\\
				\bottomrule
			\end{tabular}
			\caption{First-order convergence in time of the forward Euler method. Note that $h^2 = 4k$. Error is computed at $t =1$.}
			\label{table:euler_time}
		\end{table}
		
		\begin{table}[h]
			\centering
			\begin{tabular}{@{}lllll@{}}
				\toprule
				$h$ & $L^\infty$ error & $L^\infty$ rate & $L^2$ error & $L^2$ rate \\
				\midrule
				1/16&	2.586792e-04&	-	&1.881419e-04&	- \\
				1/32&	6.542069e-05&	1.983345&	4.688000e-05&	2.004777 \\
				1/64&	1.625258e-05&	2.009078&	1.164655e-05&	2.009070 \\
				1/128&	3.968078e-06&	2.034156&	2.843515e-06&	2.034156 \\
				1/256&	8.974522e-07&	2.144533&	6.430914e-07&	2.144580\\
				\bottomrule
			\end{tabular}
			\caption{Second-order convergence in space of the forward Euler method. Note that $k = \frac{1}{16384}$. Error is computed at $t =1$.}
			\label{table:euler_space}
		\end{table}
		
	\end{alphaparts}
	
	\question
	
	
	\begin{alphaparts}
		\questionpart
		Discretizing this equation on the time interval $[0,1]$ using a central difference method in space and the Crank-Nicolson method in time with the space sample points $x_i = ih$ for $i =0,1,\dots, M$ and time sample points $t_n = nk$ for $n=0,1,\dots N$, where $h = \frac{1}{M}$, and $k = \frac{1}{N}$, we obtain
		\begin{align*}
			\frac{u^n_{i+1} - u^n_i}{k} &= \frac{1}{2}\left[\frac{1}{2}\cdot\frac{u^n_{i-1}-2u^n_i + u^n_{i+1}}{h^2} + f(x_i,t_n) + \frac{1}{2}\cdot\frac{u^{n+1}_{i-1}-2u^{n+1}_i + u^{n+1}_{i+1}}{h^2} + f(x_i,t_{n+1})\right],\\
			 &\qquad i =1,2,\dots, M-1, \; n = 0,1,\dots, N-1,\\
			u^n_0 &= e^{-t_n}, \quad u^n_{M} = -e^{-t_n}, \qquad n = 0,1,\dots, N,\\
			u^0_i &= \sin\left(\pi\left(x+\frac{1}{2}\right)\right), \qquad i = 0,1,\dots, M.
		\end{align*}
		where $u^n_i \approx u(x_i, t_n)$. We can rewrite this system as
		\begin{equation*}
			U^{n+1} = U^n + \frac{k}{2}\left(AU^n + b^n+AU^{n+1} + b^{n+1}\right),
		\end{equation*}
		where $A$ and $b^n$ are defined in the same way as in Problem 1. This linear recurrence is implemented in \verb*|problem2.m| using a simple for loop; note that we can solve the following, equivalent linear system for $U^{n+1}$ in terms of $U^n$ by using a linear solver like the \texttt{$\backslash$} operator in MATLAB:
		\begin{equation*}
			\left(I - \frac{k}{2}A\right)U^{n+1} = U^n + \frac{k}{2}\left(AU^n + b^n + b^{n+1}\right)
		\end{equation*}
		
		\questionpart To observe second-order convergence in time of the Crank-Nicolson method, we calculate the error at various time step values $k$ while keeping the spatial step size $h$ much smaller than the smallest value of $k$; see Table \ref{table:cn_time}.
		
		To observe second-order convergence in space of the Crank-Nicolson method, we calculate the error for various values of $h$ with $k$ fixed; see Table \ref{table:euler_space}. These tables are generated by running \verb*|problem2_calculations.m|. See \verb*|p2_outputs.txt| for the raw outputs.
		\begin{table}[h]
			\centering
			\begin{tabular}{@{}lllll@{}}
				\toprule
				$k$ & $L^\infty$ error & $L^\infty$ rate & $L^2$ error & $L^2$ rate \\
				\midrule
				1/8	&2.173901e-05&	-	&1.536419e-05&	-\\
				1/16&	5.358565e-06&	2.020368&	3.841918e-06&	1.999673\\
				1/32&	1.328935e-06&	2.011576&	9.522130e-07&	2.012471\\
				1/64&	3.202598e-07&	2.052956&	2.294772e-07&	2.052933\\
				1/128&	6.808230e-08&	2.233891&	4.877780e-08&	2.234055\\
				\bottomrule
			\end{tabular}
			\caption{Second-order convergence in time of the Crank-Nicolson method. Note that $h=\frac{1}{2048}$. Error is computed at $t =1$.}
			\label{table:cn_time}
		\end{table}
		
		\begin{table}[h]
			\centering
			\begin{tabular}{@{}lllll@{}}
				\toprule
				$h$ & $L^\infty$ error & $L^\infty$ rate & $L^2$ error & $L^2$ rate \\
				\midrule
				1/16&	2.587832e-04	&-	&1.882175e-04&	-\\
				1/32&	6.552588e-05	&1.981607&	4.695538e-05&	2.003039\\
				1/64&	1.635768e-05	&2.002097&	1.172187e-05&	2.002088\\
				1/128&	4.073157e-06	&2.005749&	2.918814e-06&	2.005748\\
				1/256&	1.002529e-06	&2.022503&	7.183869e-07&	2.022549\\
				\bottomrule
			\end{tabular}
			\caption{Second-order convergence in space of the Crank-Nicolson method. Note that $k = \frac{1}{256}$. Error is computed at $t =1$.}
			\label{table:cn_space}
		\end{table}
	\end{alphaparts}
	
	
\end{document}